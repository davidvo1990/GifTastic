<!DOCTYPE html>
<html lang="en-us">

<head>
    <meta charset="UTF-8">
    <title></title>

    <!-- Link to the jQuery Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
        integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">

    <!-- AND/OR YOUR OWN CSS -->
    <!-- <link rel="stylesheet" href="assets/css/reset.css"> -->
    <!-- <link rel="stylesheet" href="assets/css/style.css"> -->
    <style>
        .img-box{
            float:left;
            /* padding:5px; */
            margin: 10px;
        }
        .character{
            margin: 10px;
        }

    </style>

</head>

<body>
    <!-- HTML start here! -->
    <div class="button-view"></div>

    <label for="input">Add:</label>
    <input class="input" type="text">
    <input class="add-char text-light btn bg-warning" type="submit" value="Submit">

    <div class="image-view"></div>
    <!-- HTML end here! -->


    <!-- Link to your JavaScript -->
    <!-- <script type="text/javascript" src="assets/javascript/game.js"></script> -->
    <script>

        var apiKey = "Khll4GtC4J8q6tXZl96C97GzmgOPgSiv"

        var queryURL;
        var topics = ["Ironman", "Captain America", "Spiderman"];

        ///////////////////////////
        //Global function call
        renderButtons();
        animateImage()
        ////////////////////////

        function renderButtons() {

            // Deleting the character buttons prior to adding new buttons
            // (this is necessary otherwise we will have repeat buttons)
            $(".button-view").empty();

            // Looping through the array of chars
            for (var i = 0; i < topics.length; i++) {

                // Then dynamicaly generating buttons for each char in the array.
                // This code $("<button>") is all jQuery needs to create the start and end tag. (<button></button>)
                var button = $("<button>");
                // buttondding button class
                button.addClass("character btn bg-warning text-light");
                // Adding a data-attribute with a value of the char at index i
                button.attr("data-name", topics[i]);
                // Providing the button's text with a value of the char at index i
                button.text(topics[i]);
                // Adding the button to the HTML
                $(".button-view").append(button);
            }
        }

        // This function handles events where one button is clicked
        $(".add-char").on("click", function (event) {
            // event.preventDefault() prevents the form from trying to submit itself.
            // We're using a form so that the user can hit enter instead of clicking the button if they want
            // event.preventDefault();

            // This line will grab the text from the input box
            var currentButton = $(".input").val().trim();
            // The character from the textbox is then added to our array
            topics.push(currentButton);

            // calling renderButtons which handles the processing of our char array
            renderButtons();
        });

        $(document).on("click", ".character", function (event) {
            $(".image-view").empty();
            var currentChar = $(this).attr("data-name");
            console.log("You click: " + currentChar);
            queryURL = "https://api.giphy.com/v1/gifs/search?limit=10&q=marvel+" + currentChar + "&api_key=" + apiKey;

            $.ajax({
                url: queryURL,
                method: "GET"
            }).then(updatePage);

            function updatePage(response) {
                console.log(response);
                var datas = response.data;

                for (var i = 0; i < datas.length; i++) {
                    var img = $("<img>");
                    img.attr("src", datas[i].images.fixed_height_small_still.url);
                    img.addClass("gif");
                    img.attr("data-still", datas[i].images.fixed_height_small_still.url)
                    img.attr("data-animate", datas[i].images.fixed_height_small.url)
                    img.attr("data-state", "still");

                    var rating = $("<div>Rating: <span>" + datas[i].rating + "</span></div>")
                    var imgDiv = $("<div>").append(rating).append(img);
                    imgDiv.addClass("img-box");


                    $(".image-view").append(imgDiv);
                }

            }
        });

        function animateImage() {
            $(document).on("click", ".gif", function () {
                var state = $(this).attr("data-state");
                // If the clicked image's state is still, update its src attribute to what its data-animate value is.
                // Then, set the image's data-state to animate
                // Else set src to the data-still value
                if (state === "still") {
                    $(this).attr("src", $(this).attr("data-animate"));
                    $(this).attr("data-state", "animate");
                } else {
                    $(this).attr("src", $(this).attr("data-still"));
                    $(this).attr("data-state", "still");
                }

            })
        }


    </script>
</body>

</html>